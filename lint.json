[{"filePath":"/home/paul/projects/control-center/filemanager/next-app/components/ui/card-stack.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":262,"column":41,"nodeType":"JSXOpeningElement","endLine":267,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useState, useEffect } from 'react';\nimport { motion, useMotionValue, useTransform, AnimatePresence } from 'framer-motion';\nimport { IconRefresh, IconArrowsShuffle, IconChevronLeft, IconChevronRight, IconX } from '@tabler/icons-react';\nimport { seriesList } from '@/lib/data/drills';\n\ninterface Card {\n    id: number;\n    src: string;\n    videoSrc?: string;\n    alt: string;\n    title: string;\n    description: string;\n}\n\nexport default function CardStack() {\n    const [seriesIndex, setSeriesIndex] = useState(0);\n    const activeSeries = seriesList[seriesIndex];\n    const initialCards: Card[] = activeSeries.cards;\n\n    const [cards, setCards] = useState<Card[]>(initialCards);\n    const [dragDirection, setDragDirection] = useState<'up' | 'down' | null>(null);\n    const [currentIndex, setCurrentIndex] = useState(0);\n    const [activeVideoIndex, setActiveVideoIndex] = useState<number | null>(null);\n\n    const [prevSeriesIndex, setPrevSeriesIndex] = useState(seriesIndex);\n\n    // Reset stack whenever the series changes\n    if (seriesIndex !== prevSeriesIndex) {\n        setPrevSeriesIndex(seriesIndex);\n        setCards(initialCards);\n        setCurrentIndex(0);\n        setDragDirection(null);\n        setActiveVideoIndex(null);\n    }\n\n    useEffect(() => {\n        if (activeVideoIndex !== null) {\n            document.body.classList.add('hide-dock');\n        } else {\n            document.body.classList.remove('hide-dock');\n        }\n        return () => document.body.classList.remove('hide-dock');\n    }, [activeVideoIndex]);\n\n    const dragY = useMotionValue(0);\n    const rotateX = useTransform(dragY, [-200, 0, 200], [15, 0, -15]);\n\n    // Configuration\n    const offset = 10;\n    const scaleStep = 0.06;\n    const dimStep = 0.15;\n    const stiff = 170;\n    const damp = 26;\n    const borderRadius = 12;\n    const swipeThreshold = 50;\n\n    const spring = {\n        type: 'spring' as const,\n        stiffness: stiff,\n        damping: damp\n    };\n\n    const moveToEnd = () => {\n        setCards(prev => [...prev.slice(1), prev[0]]);\n        setCurrentIndex((prev) => (prev + 1) % initialCards.length);\n    };\n\n    const moveToStart = () => {\n        setCards(prev => [prev[prev.length - 1], ...prev.slice(0, -1)]);\n        setCurrentIndex((prev) => (prev - 1 + initialCards.length) % initialCards.length);\n    };\n\n    const shuffleCards = () => {\n        const shuffled = [...cards].sort(() => Math.random() - 0.5);\n        setCards(shuffled);\n    };\n\n    const nextSeries = () => {\n        setSeriesIndex((prev) => (prev + 1) % seriesList.length);\n    };\n\n    const prevSeries = () => {\n        setSeriesIndex((prev) => (prev - 1 + seriesList.length) % seriesList.length);\n    };\n\n    const resetCards = () => {\n        setCards(initialCards);\n        setCurrentIndex(0);\n    };\n\n    const handleDragEnd = (_: unknown, info: { offset: { y: number }, velocity: { y: number } }) => {\n        const velocity = info.velocity.y;\n        const offset = info.offset.y;\n\n        if (Math.abs(offset) > swipeThreshold || Math.abs(velocity) > 500) {\n            if (offset < 0 || velocity < 0) {\n                setDragDirection('up');\n                setTimeout(() => {\n                    moveToEnd();\n                    setDragDirection(null);\n                }, 150);\n            } else {\n                setDragDirection('down');\n                setTimeout(() => {\n                    moveToStart();\n                    setDragDirection(null);\n                }, 150);\n            }\n        }\n        dragY.set(0);\n    };\n\n    return (\n        <div className={`w-full h-screen flex items-center justify-center bg-background text-foreground transition-all duration-500 relative overflow-hidden`}>\n            {/* Animated Grid Background */}\n            <svg\n                className=\"absolute inset-0 w-full h-full opacity-10 transition-opacity duration-300\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n            >\n                <defs>\n                    <pattern\n                        id=\"grid\"\n                        width=\"40\"\n                        height=\"40\"\n                        patternUnits=\"userSpaceOnUse\"\n                    >\n                        <motion.path\n                            d=\"M 40 0 L 0 0 0 40\"\n                            fill=\"none\"\n                            stroke=\"currentColor\"\n                            className=\"text-foreground/20\"\n                            strokeWidth=\"0.5\"\n                            initial={{ pathLength: 0 }}\n                            animate={{ pathLength: 1 }}\n                            transition={{ duration: 2, repeat: Infinity }}\n                        />\n                    </pattern>\n                </defs>\n                <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n            </svg>\n\n            {/* Top Control Bar */}\n            <div className=\"absolute top-8 left-8 right-8 flex items-center justify-start z-30\">\n                <div className=\"flex gap-2\">\n                    <motion.button\n                        onClick={resetCards}\n                        className={`p-3 rounded-full bg-secondary hover:bg-secondary/80 text-secondary-foreground border border-border backdrop-blur-sm transition-colors duration-200`}\n                        whileHover={{ scale: 1.05 }}\n                        whileTap={{ scale: 0.95 }}\n                        title=\"Reset\"\n                    >\n                        <IconRefresh className=\"w-5 h-5\" />\n                    </motion.button>\n                    <motion.button\n                        onClick={shuffleCards}\n                        className={`p-3 rounded-full bg-secondary hover:bg-secondary/80 text-secondary-foreground border border-border backdrop-blur-sm transition-colors duration-200`}\n                        whileHover={{ scale: 1.05 }}\n                        whileTap={{ scale: 0.95 }}\n                        title=\"Shuffle\"\n                    >\n                        <IconArrowsShuffle className=\"w-5 h-5\" />\n                    </motion.button>\n                </div>\n            </div>\n\n            {/* Navigation Buttons (Series Switchers) */}\n            <motion.button\n                onClick={prevSeries}\n                className={`absolute left-8 top-1/2 -translate-y-1/2 p-4 rounded-full bg-secondary hover:bg-secondary/80 text-secondary-foreground border border-border backdrop-blur-sm transition-colors duration-200 z-20 hidden md:block`}\n                whileHover={{ scale: 1.1, x: -5 }}\n                whileTap={{ scale: 0.9 }}\n                title=\"Previous Series\"\n            >\n                <IconChevronLeft className=\"w-6 h-6\" />\n            </motion.button>\n\n            <motion.button\n                onClick={nextSeries}\n                className={`absolute right-8 top-1/2 -translate-y-1/2 p-4 rounded-full bg-secondary hover:bg-secondary/80 text-secondary-foreground border border-border backdrop-blur-sm transition-colors duration-200 z-20 hidden md:block`}\n                whileHover={{ scale: 1.1, x: 5 }}\n                whileTap={{ scale: 0.9 }}\n                title=\"Next Series\"\n            >\n                <IconChevronRight className=\"w-6 h-6\" />\n            </motion.button>\n\n            {/* Card Stack Container */}\n            <div className=\"relative portrait:w-64 portrait:h-96 landscape:w-96 landscape:h-64 sm:portrait:w-80 sm:portrait:h-[28rem] sm:landscape:w-[28rem] sm:landscape:h-80 md:w-[32rem] md:h-80 overflow-visible z-10 transition-all duration-300\">\n                <ul className=\"relative w-full h-full m-0 p-0\">\n                    <AnimatePresence>\n                        {cards.map((card, i) => {\n                            const { id, src, alt, title, description, videoSrc } = card;\n                            const isFront = i === 0;\n                            const brightness = Math.max(0.3, 1 - i * dimStep);\n                            const baseZ = cards.length - i;\n\n                            return (\n                                <motion.li\n                                    key={id}\n                                    className={`absolute w-full h-full list-none overflow-hidden border-2 border-border bg-black group`}\n                                    style={{\n                                        borderRadius: `${borderRadius}px`,\n                                        cursor: isFront ? 'grab' : 'auto',\n                                        touchAction: 'none',\n                                        boxShadow: isFront\n                                            ? '0 25px 50px -12px rgba(0, 0, 0, 0.5)'\n                                            : '0 15px 30px -10px rgba(0, 0, 0, 0.3)',\n                                        rotateX: isFront ? rotateX : 0,\n                                        transformPerspective: 1000\n                                    }}\n                                    animate={{\n                                        top: `${i * -offset}%`,\n                                        scale: 1 - i * scaleStep,\n                                        filter: `brightness(${brightness})`,\n                                        zIndex: baseZ,\n                                        opacity: dragDirection && isFront ? 0 : 1\n                                    }}\n                                    exit={{\n                                        opacity: 0,\n                                        scale: 0.8,\n                                        transition: { duration: 0.2 }\n                                    }}\n                                    transition={spring}\n                                    drag={isFront ? 'y' : false}\n                                    dragConstraints={{ top: 0, bottom: 0 }}\n                                    dragElastic={0.7}\n                                    onDrag={(_, info) => {\n                                        if (isFront) {\n                                            dragY.set(info.offset.y);\n                                        }\n                                    }}\n                                    onDragEnd={handleDragEnd}\n                                    onDoubleClick={() => {\n                                        if (videoSrc) {\n                                            const originalIndex = initialCards.findIndex(d => d.id === card.id);\n                                            if (originalIndex !== -1) {\n                                                setActiveVideoIndex(originalIndex);\n                                            }\n                                        }\n                                    }}\n                                    whileDrag={\n                                        isFront\n                                            ? {\n                                                zIndex: cards.length + 1,\n                                                cursor: 'grabbing',\n                                                scale: 1.05,\n                                            }\n                                            : {}\n                                    }\n                                >\n                                    {videoSrc && isFront ? (\n                                        <video\n                                            src={videoSrc}\n                                            className=\"w-full h-full object-cover pointer-events-none select-none\"\n                                            autoPlay\n                                            muted\n                                            loop\n                                            playsInline\n                                        />\n                                    ) : (\n                                        <img\n                                            src={src}\n                                            alt={alt}\n                                            className=\"w-full h-full object-cover pointer-events-none select-none\"\n                                            draggable={false}\n                                        />\n                                    )}\n\n                                    {/* Card Info Overlay */}\n                                    <div\n                                        className={`absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 to-transparent transition-all duration-300 z-10 ${isFront\n                                            ? 'opacity-100 translate-y-0 md:opacity-0 md:translate-y-4 md:group-hover:opacity-100 md:group-hover:translate-y-0'\n                                            : 'opacity-0 translate-y-4 pointer-events-none'\n                                            }`}\n                                    >\n                                        <h3 className=\"text-white font-bold text-lg\">{title}</h3>\n                                        <p className=\"text-white/80 text-sm line-clamp-2\">{description}</p>\n                                    </div>\n                                </motion.li>\n                            );\n                        })}\n                    </AnimatePresence>\n                </ul>\n            </div>\n\n            {/* Progress Indicator */}\n            <div className=\"absolute top-24 left-1/2 -translate-x-1/2 flex gap-2 z-20\" title={`Card ${currentIndex + 1} of ${initialCards.length}`}>\n                {initialCards.map((_, i) => (\n                    <motion.div\n                        key={i}\n                        className={`h-1.5 rounded-full transition-all duration-300 ${i === currentIndex % initialCards.length\n                            ? `bg-primary w-8`\n                            : `bg-muted w-1.5`\n                            }`}\n                        whileHover={{ scale: 1.2 }}\n                    />\n                ))}\n            </div>\n\n            {/* Fullscreen Video Overlay */}\n            <AnimatePresence>\n                {activeVideoIndex !== null && initialCards[activeVideoIndex]?.videoSrc && (\n                    <motion.div\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        exit={{ opacity: 0 }}\n                        className=\"fixed inset-0 z-[100] bg-black flex items-center justify-center overflow-hidden\"\n                    >\n                        <button\n                            onClick={() => setActiveVideoIndex(null)}\n                            className=\"absolute top-6 right-6 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white backdrop-blur-md transition-colors z-[110]\"\n                        >\n                            <IconX className=\"w-8 h-8\" />\n                        </button>\n\n                        {/* Left Arrow */}\n                        {activeVideoIndex > 0 && (\n                            <button\n                                onClick={(e) => {\n                                    e.stopPropagation();\n                                    setActiveVideoIndex(activeVideoIndex - 1);\n                                }}\n                                className=\"absolute left-6 top-1/2 -translate-y-1/2 p-4 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-md transition-colors z-[110]\"\n                            >\n                                <IconChevronLeft className=\"w-8 h-8\" />\n                            </button>\n                        )}\n\n                        {/* Right Arrow */}\n                        {activeVideoIndex < initialCards.length - 1 && (\n                            <button\n                                onClick={(e) => {\n                                    e.stopPropagation();\n                                    setActiveVideoIndex(activeVideoIndex + 1);\n                                }}\n                                className=\"absolute right-6 top-1/2 -translate-y-1/2 p-4 rounded-full bg-black/50 hover:bg-black/70 text-white backdrop-blur-md transition-colors z-[110]\"\n                            >\n                                <IconChevronRight className=\"w-8 h-8\" />\n                            </button>\n                        )}\n\n                        <motion.div\n                            key={activeVideoIndex}\n                            initial={{ opacity: 0, x: 50 }}\n                            animate={{ opacity: 1, x: 0 }}\n                            exit={{ opacity: 0, x: -50 }}\n                            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n                            className=\"w-full h-full outline-none\"\n                            drag=\"x\"\n                            dragConstraints={{ left: 0, right: 0 }}\n                            dragElastic={0.2}\n                            onDragEnd={(e, { offset }) => {\n                                const swipe = offset.x;\n                                if (swipe < -50 && activeVideoIndex < initialCards.length - 1) {\n                                    setActiveVideoIndex(activeVideoIndex + 1);\n                                } else if (swipe > 50 && activeVideoIndex > 0) {\n                                    setActiveVideoIndex(activeVideoIndex - 1);\n                                }\n                            }}\n                        >\n                            <video\n                                src={initialCards[activeVideoIndex].videoSrc}\n                                controls\n                                autoPlay\n                                className=\"w-full h-full object-cover outline-none\"\n                            />\n                        </motion.div>\n                    </motion.div>\n                )}\n            </AnimatePresence>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]}]
